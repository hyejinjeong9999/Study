# JSP

## JSP 배경

* 클라이언트 사이드 프로그래밍

  * 클라이언트 컴퓨터 쪽에서 실행되는 프로그램만 장석하는 것

* 서버 사이드 프로그래밍

  * 동적 웹페이지가 대표적

* 동적 웹 페이지

  * 사용자의 요청에 따라 웹 페이지의 내용이 달라짐
  * 게시판, 블로그, 방명록
  * 도우미 프로그램(CGI)을 작성하고 필요시 실행시킴
    * Perl, C, python, PHP, ASP 등 사용
  * 클라이언트 요청이 있을 때 마다 새로운 CGI 생성

* 웹서버에서의 자바

  * 플랫폼에 독립적, 스레드 사용 => 효율적, 풍부한 라이브러리
  * 서블릿 사용
    * 효율적 : 스레드를 생성해 각 요청을 서비스
      * 요청이 있을 때마다 새로운 프로세스를 생성하는 CGI에 비해 효율적 
    * 편리 : java 개발자는  서버 스크립트 언어 학습 필요가 없음
      * 강력 : 기존 CGI에서 못했던 작업을 쉽게 처리할 수 있다
        * 웹서버와 직접 통신을 하는 등..
      * 이식성 : 플랫폼과 관계 없이 실행 가능
  * 자바 언어 안에 HTML 언어를 넣어야 하는 어려움
    * JSP가 개발됨

* JSP

  * 자바를 기반으로 동적인 웹페이지를 구축할 수 있는 서버-사이드-스크립트언어

  * 자바 서블릿을 기반으로 함

  * HTML 문서 안에 필요한 자바 코드가 들어감

    * 서블릿과는 반대

  * HTML 페이지 안에 필요할 때마다 `<%..%>`를 이용해 삽입

  * 웹서버가 JSP처리를 하려면 JSP 엔진 필요

    * JSP엔진 : JSP가 필요로 하는 실행환경과 다른 서비스 제공
    * 톰캣이 대표적

  * 동작구조

    ![image-20200116185750147](../../../../혜/til/img/image-20200116185750147.png)



## JSP사용

#### JSP의 특징 : 소스가 드러나지 않음



* 실제 입력

````jsp
<body>
	안녕하세요? 현재 시각은 <%= new java.util.Date() %>입니다.
	
</body>
````

* 소스보기를 통해 확인

  ````jsp
  <body>
  	안녕하세요? 현재 시각은 Thu Jan 16 19:07:22 KST 2020입니다.
  	
  </body>
  ````

  > 소스코드가 그대로 드러나지 않음
  >
  > 개발자의 소스는 보호됨, 스크립트에 의해 생성된 소스만 확인

#### 표현식

````html
<%= expression %></%>
````

* `<%=` 
  * `<%` JSP를 의미 
  * `=` 자바 수식을 의미
* expression
  * 자바의 어느 수식이든 넣을 수 있음
  * 변수, 값, 메소드 가능
  * 수식은 계산 된 후 String 객체로 변환되어 나타남
* `%>`
  * JSP가 종료됨

#### 스크립틀릿

* 많은 분량의 자바 코드 블록 작성

````html
<% code_block%>
````

* `<%`
  * 자바 코드의 시작을 알림
* code_block
  * 어떠한 코드 블록도 가능
* `%>`
  * 자바 코드의 종료를 알림

````jsp
<body>
	<% 
		System.out.println("날짜를 출력해보기");
		 java.util.Date date = new java.util.Date();
	%>	
	안녕하세요 ? 현재 시각은
	<%
		out.println(String.valueOf(date));
	%>
	입니다
</body>
````

> 결과 : 안녕하세요 ? 현재 시각은 Thu Jan 16 19:28:07 KST 2020 입니다



#### 스크립틀립과 HTML 혼합하기

* 스크립틀립 안에서 HTML 출력 가능
  * JSP 프로그래밍 장점을 해치는 행위
* 스크립틀립과 HTML 혼합이 더 효율적

````jsp
<body>
	<table border=2>
		<%
			int n = 3;
			for (int i = 0; i < n; i++) {
		%>
		<TR>
			<TD>Number</TD>
			<TD><%= i + 1 %></TD>
		</TR>
		<%
			}
		%>


	</table>
````

* `<%` : 스크립틀릿으로 돌아감
* `%>` HTML로 돌아감
* `<TR>` : for 문 안에 있어서 반복문 실행됨

![image-20200116194143276](../../../../혜/til/img/image-20200116194143276.png)



#### JSP 지시어

1. page

````jsp
    <%@ page import="java.util.*"%>
````

* `<%@`
  
      * 지시어의 시작
* `page`
  
      * 페이지에 관한 지시어
* `import="java.util.*"`
  
      * 페이지를 읽어들임
* %>
      * 지시어의 끝
  
    ````jsp
    
    <!DOCTYPE html>
    <%@ page import="java.util.*"%>
    
    <html>
    <head>
    <meta charset="UTF-8">
    <title></title>
    </head>
    <body>
    	<%
    		Date date = new Date();
    	%>
    	안녕하세요? 현재 시간은
    	<%=date%>
    	입니다.
    </body>
    </html>
    ````
  
    * 이전처럼 java.util을 일일히 넣어 줄 필요가 없다
  
2. includ

    * 물리적으로 다른 파일을 내용의 내용을 포함할 때

    ````  jsp
    <body>
    아래에서 ex01_basic jsp를 포함시킴
    <%@ include file ="ex01_basic.jsp" %>
    	
    </body>
    ````

    

3. taglib

    * 지시어를 부를 수 있음

#### JSP 선언

* JSP는 하나의 클래스로 변환
* 필요한 변수와 메서드 선언을 이 클래스에 추가 할 수 있음

  * 변수, 메서드 추가를 위한 선언


```jsp
 <%@ Date date;...%>
```

* `<%@`
  * 선언의 시작
* `Date date;...`
  * 변수 선언이나 메서드의 정의
* `.%>`
  * 변수 선언의 끝
* 

## 함수

#### out

* html 출력

````jsp
안녕하세요 ? 현재 시각은
	<%
		out.println(String.valueOf(date));
	%>
	입니다
````



#### request

* 브라우저와 서버 사이의 상호작용을 참조
* 브라우저가 보낸 요청에서 정보를 얻을 때
  * 클라이언트 호스트 이름, ip주소..

````jsp
<body>
	<%
		java.util.Date date = new java.util.Date();
	%>
	안녕하세요 ? 현재 시각은
	<%
		out.println(date);
		out.println("<BR>이고 ip 주소는 ");
		out.println(request.getRemoteAddr());
	%>
	입니다
</body>
````

> 실행결과 : 
>
> 안녕하세요 ? 현재 시각은 Thu Jan 16 19:32:53 KST 2020
> 이고 ip 주소는 0:0:0:0:0:0:0:1 입니다



모델 1방식

반드시 톰켓을 타야함!!!

jsp  표현방식의 3가지 종류

`<%@%>`

includ  : 현재 내 페이지 내에서 다른 페이지를 가져온다

, page :  

,taglib

지시어를 부를 수 있음

1) 스크립트릿 : <% 자바변수선언, 제어문, 함수못씀 %>

2)선언문

 <%! 제어문 못옴, 변수선언, 함수사용 가능>

3) 표현식

<%=변수 또는 값 또는 메소드 %>



톰켓서버가 해석기



모델 2 방식

JSTL